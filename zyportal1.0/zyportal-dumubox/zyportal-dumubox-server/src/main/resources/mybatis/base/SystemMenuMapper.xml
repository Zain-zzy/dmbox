<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zkzy.portal.dumu.server.system.provider.mapper.base.SystemMenuMapper">
    <resultMap id="BaseResultMap" type="com.zkzy.zyportal.system.api.entity.base.SystemMenu">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Apr 24 15:44:57 CST 2017.
        -->
        <result column="ID" jdbcType="DECIMAL" property="id"/>
        <result column="PARENT_ID" jdbcType="DECIMAL" property="parentId"/>
        <result column="NAME" jdbcType="VARCHAR" property="name"/>
        <result column="SORT" jdbcType="DECIMAL" property="sort"/>
        <result column="TYPE" jdbcType="VARCHAR" property="type"/>
        <result column="URL" jdbcType="VARCHAR" property="url"/>
        <result column="PERMISSION" jdbcType="VARCHAR" property="permission"/>
        <result column="ICON" jdbcType="VARCHAR" property="icon"/>
        <result column="STATUS" jdbcType="VARCHAR" property="status"/>
        <result column="DESCRIPTION" jdbcType="VARCHAR" property="description"/>
        <result column="CREATEDATE" jdbcType="DATE" property="createdate"/>
        <result column="UPDATEDATE" jdbcType="DATE" property="updatedate"/>
        <result column="ROLEMENUID" jdbcType="VARCHAR" property="rolemenuid"/>
    </resultMap>


    <sql id="selectColumns">
    SELECT DISTINCT
    a.id,
    a.PARENT_ID,
    a.name,
    a.sort,
    a.type,
    a.URL,
    a.permission,
    a.icon,
    a.STATUS,
    a.DESCRIPTION,
    a.CREATEDATE,
    a.UPDATEDATE
    FROM SYSTEM_MENU a
  </sql>


    <select id="findListByUserId" resultType="com.zkzy.zyportal.system.api.entity.base.SystemMenu">
        <include refid="selectColumns"/>
        inner JOIN SYSTEM_ROLE_MENU rm ON rm.PERMISSION_ID = a.id
        inner JOIN SYSTEM_ROLE r ON r.id = rm.ROLE_ID AND r.STATUS = '1'
        inner JOIN SYSTEM_USER_ROLE ur ON ur.ROLE_ID = r.id
        inner JOIN SYSTEM_USERS u ON u.id = ur.USER_ID AND u.STATUS='1' AND u.id = #{userId}
        WHERE a.STATUS = '1'
        ORDER BY a.sort
    </select>
</mapper>